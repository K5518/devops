import{_ as L,h as a,p as K}from"./hooks.module.588e47ed.js";import{D as O}from"./index.es.ebad3893.js";/* empty css                       */import{u as V}from"./use-outside-click.48e5e038.js";import{u as Y}from"./use-keydown.6a88dc80.js";import{a as C}from"./http.82ebf0f1.js";import{t as b}from"./resource-progress.069a7d3a.js";import{C as F}from"./close.3a539829.js";import{g as Q,d as I}from"./browser.bcc09af3.js";import{u as W}from"./use-auth.13ac07ad.js";import{S as X}from"./Spinner.5c883e87.js";import{E as Z}from"./ErrorIcon.bc06c552.js";import{o as e}from"./jsxRuntime.module.c718f406.js";import{k as w}from"./preact.module.ce248672.js";import"./jwt.f0e0aa9c.js";function fe(U){const{resourceId:i,resourceType:h,userId:j,onClose:M}=U,{s:n=j}=Q(),$=L(null),v=L(null),R=W();if(!n||R?.id===n)return I("s"),null;const[T,A]=a(!!n),[D,q]=a(null),[k,_]=a(),[u,E]=a(!0),[f,S]=a("");let c="https://roadmap.sh";h==="roadmap"?c+=`/${i}.json`:c+=`/best-practices/${i}.json`;async function z(r,t,o){const{error:p,response:m}=await C(`https://api.roadmap.sh/v1-get-user-progress/${r}?resourceType=${t}&resourceId=${o}`);if(p||!m)throw p||new Error("Something went wrong. Please try again!");return m}async function G(r){const{error:t,response:o}=await C(r);if(t||!o)throw t||new Error("Something went wrong. Please try again!");return await O(o,{fontURL:"/fonts/balsamiq.woff2"})}function g(){I("s"),S(""),A(!1),M?.()}Y("Escape",()=>{g()}),V(v,()=>{g()}),K(()=>{!c||!i||!h||(E(!0),Promise.all([G(c),z(n,h,i)]).then(([r,t])=>{if(!t||!r)return;const{progress:o}=t,{done:p,learning:m,skipped:B}=o||{done:[],learning:[],skipped:[]};p?.forEach(s=>{b(s,r).forEach(l=>{l.classList.add("done")})}),m?.forEach(s=>{b(s,r).forEach(l=>{l.classList.add("learning")})}),B?.forEach(s=>{b(s,r).forEach(l=>{l.classList.add("skipped")})}),r.querySelectorAll(".clickable-group").forEach(s=>{s.classList.remove("clickable-group")}),r.querySelectorAll("[data-group-id]").forEach(s=>{s.removeAttribute("data-group-id")}),q(r),_(t)}).catch(r=>{S(r?.message||"Something went wrong. Please try again!")}).finally(()=>{E(!1)}))},[n]);const H=k?.user,d=k?.progress,x=d?.total||0,y=d?.done?.length||0,N=Math.round(y/x*100)||0,J=d?.learning?.length||0,P=d?.skipped?.length||0;return T?u||f?e("div",{class:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{class:"relative mx-auto flex h-full w-full items-center justify-center",children:e("div",{className:"popup-body relative rounded-lg bg-white p-5 shadow",children:e("div",{className:"flex items-center",children:[u&&e(w,{children:[e(X,{className:"h-6 w-6",isDualRing:!1}),e("span",{className:"ml-3 text-lg font-semibold",children:"Loading user progress..."})]}),f&&e(w,{children:[e(Z,{additionalClasses:"h-6 w-6 text-red-500"}),e("span",{className:"ml-3 text-lg font-semibold",children:f})]})]})})})}):e("div",{id:"user-progress-modal",class:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{class:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e("div",{ref:v,class:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[e("div",{className:"p-4",children:[e("div",{className:"mb-5 mt-0 min-h-[28px] text-left sm:text-center md:mt-4 md:h-[60px]",children:[e("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[H?.name,"'s Progress"]}),e("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:"You can close this popup and start tracking your progress."})]}),e("p",{class:"-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden",children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:N}),"% Done"]}),e("span",{children:[e("span",{children:y})," of ",e("span",{children:x})," done"]})]}),e("p",{class:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${u?"striped-loader":""}`,children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:N}),"% Done"]}),e("span",{children:[e("span",{children:y})," completed"]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{children:J})," in progress"]}),P>0&&e(w,{children:[e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{children:P})," skipped"]})]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{children:x})," Total"]})]})]}),e("div",{ref:$,className:"px-4 pb-2",dangerouslySetInnerHTML:{__html:D?.outerHTML||""}}),e("button",{type:"button",className:"absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-gray-100 bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden",onClick:g,children:[e("img",{alt:"close",src:F,className:"h-4 w-4"}),e("span",{class:"sr-only",children:"Close modal"})]})]})})}):null}export{fe as UserProgressModal};
