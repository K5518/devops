import{h as v,_ as K,p as T}from"./hooks.module.588e47ed.js";import{u as W}from"./use-team-id.c4977929.js";import{a as H}from"./http.82ebf0f1.js";import{p as j}from"./page.c1a8a472.js";import{o as e}from"./jsxRuntime.module.c718f406.js";import{k as D}from"./preact.module.ce248672.js";import{u as V}from"./use-toast.fb52de5d.js";import{u as Y}from"./index.9fd707a6.js";import{b as q}from"./team.12f2469e.js";import{g as J,s as X}from"./browser.bcc09af3.js";import{E as Z}from"./external-link.a7a2cda9.js";import{u as G}from"./use-auth.13ac07ad.js";import{D as ee}from"./index.es.ebad3893.js";import{S as re}from"./Spinner.5c883e87.js";/* empty css                       */import{u as se}from"./use-outside-click.48e5e038.js";import{u as te}from"./use-keydown.6a88dc80.js";import{a as S,u as ne}from"./resource-progress.069a7d3a.js";import{C as ae}from"./close.3a539829.js";import"./jwt.f0e0aa9c.js";import"./index.a98c85f5.js";import"./toast.1fe7142d.js";function oe(g){const{member:s,onShowResourceProgress:a,isMyProgress:m=!1}=g,h=s?.progress?.sort((o,d)=>d.done-o.done),[f,u]=v(!1);return e(D,{children:e("div",{className:"flex h-full min-h-[270px] flex-col overflow-hidden rounded-md border",children:[e("div",{className:"relative flex items-center gap-3 border-b p-3",children:[e("img",{src:s.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${s.avatar}`:"/images/default-avatar.png",alt:s.name||"",className:"h-8 w-8 rounded-full"}),e("div",{className:"inline-grid w-full",children:[!m&&e("h3",{className:"truncate font-medium",children:s.name}),m&&e("div",{className:"inline-grid grid-cols-[auto,32px] items-center gap-1.5",children:[e("h3",{className:"truncate font-medium",children:s.name}),e("span",{className:"rounded-md bg-red-500 px-1 py-0.5 text-xs text-white",children:"You"})]}),e("p",{className:"truncate text-sm text-gray-500",children:s.email})]})]}),e("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(f?h:h.slice(0,4)).map(o=>e("button",{onClick:()=>a(o.resourceId),className:"group relative overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none",children:[e("span",{className:"relative z-10 flex items-center justify-between text-sm",children:[e("span",{className:"inline-grid",children:e("span",{className:"truncate",children:o.resourceTitle})}),e("span",{className:"ml-1.5 shrink-0 text-xs text-gray-400",children:[o.done," / ",o.total]})]}),e("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${o.done/o.total*100}%`}})]},o.resourceId)),h.length>4&&!f&&e("button",{onClick:()=>u(!0),className:"text-sm text-gray-400 underline",children:["+ ",h.length-4," more"]}),f&&e("button",{onClick:()=>u(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),h.length===0&&e("div",{className:"text-sm text-gray-500",children:"No progress"})]})]},s._id)})}function le(g){const{onShowResourceProgress:s}=g,{members:a,resourceTitle:m,resourceId:h}=g.roadmap,{t:f}=J(),u=G(),[o,d]=v(!1);return e(D,{children:e("div",{className:"flex h-full min-h-[270px] flex-col rounded-md border",children:[e("div",{className:"flex items-center gap-3 border-b p-3",children:e("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[e("h3",{className:"truncate font-medium",children:m}),e("a",{href:`/${h}?t=${f}`,className:"group mb-0.5 flex shrink-0 items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:e("img",{alt:"link",src:Z,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})})]})}),e("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(o?a:a.slice(0,4)).map(l=>{const p=u?.email===l?.member?.email;return l.progress?e("button",{className:`group relative w-full overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none ${p?"border-green-500 hover:border-green-600":""}`,onClick:()=>{s(l.member,l.progress?.resourceId)},children:[e("span",{className:"relative z-10 flex items-center justify-between gap-1 text-sm",children:[e("span",{className:"inline-grid grid-cols-[20px_auto] gap-3",children:[e("img",{src:l.member.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${l.member.avatar}`:"/images/default-avatar.png",alt:l.member.name||"",className:"h-5 w-5 shrink-0 rounded-full"}),e("span",{className:"inline-grid grid-cols-[auto,32px] items-center",children:e("span",{className:"mr-[5px] truncate",children:l?.member?.name})})]}),e("span",{className:"shrink-0 text-xs text-gray-400",children:[l?.progress?.done," / ",l?.progress?.total]})]}),e("span",{className:`absolute inset-0 ${p?"bg-green-100 group-hover:bg-green-200":"bg-gray-100 group-hover:bg-gray-200"}`,style:{width:`${l?.progress?.done/l?.progress?.total*100}%`}})]},l?.member._id):null}),a.length>4&&!o&&e("button",{onClick:()=>d(!0),className:"text-sm text-gray-400 underline",children:["+ ",a.length-4," more"]}),o&&e("button",{onClick:()=>d(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),a.length===0&&e("div",{className:"text-sm text-gray-500",children:"No progress"})]})]})})}function ie(g){const{resourceId:s,member:a,resourceType:m,onShowMyProgress:h,teamId:f,onClose:u}=g,d=G()?.email===a.email,l=Y(q),p=K(null),b=K(null),[$,_]=v(!1),[N,t]=v(),[i,y]=v(!0),k=V();let C="https://roadmap.sh";m==="roadmap"?C+=`/${s}.json`:C+=`/best-practices/${s}.json`;async function z(r,n,c,x){const{error:w,response:P}=await H(`https://api.roadmap.sh/v1-get-member-resource-progress/${r}/${n}?resourceType=${c}&resourceId=${x}`);if(w||!P){k.error(w?.message||"Failed to get member progress");return}return t(P),P}async function O(r){const c=await(await fetch(r)).json(),x=await ee(c,{fontURL:"/fonts/balsamiq.woff2"});p.current?.replaceChildren(x)}te("Escape",()=>{$||u()}),se(b,()=>{$||u()}),T(()=>{!p.current||!C||!s||!m||!f||(y(!0),Promise.all([O(C),z(f,a._id,m,s)]).then(([r,n={}])=>{const{removed:c=[],done:x=[],learning:w=[],skipped:P=[]}=n;x.forEach(I=>S(I,"done")),w.forEach(I=>S(I,"learning")),P.forEach(I=>S(I,"skipped")),c.forEach(I=>S(I,"removed"))}).catch(r=>{console.error(r),k.error(r?.message||"Something went wrong. Please try again!")}).finally(()=>{y(!1)}))},[a]);function M(r,n){!s||!m||!d||(j.set("Updating progress"),ne({resourceId:s,resourceType:m,topicId:r},n).then(()=>{S(r,n),z(f,a._id,m,s).then(c=>{t(c)})}).catch(c=>{alert("Something went wrong, please try again."),console.error(c)}).finally(()=>{j.set("")}))}async function U(r){const n=r.target?.closest("g");if(!n)return;const c=n.dataset?n.dataset.groupId:"";if(!c)return;if(n.classList.contains("removed")){r.preventDefault();return}r.preventDefault();const x=n.classList.contains("done"),w=c.replace(/^\d+-/,"");M(w,x?"pending":"done")}async function A(r){const n=r.target?.closest("g");if(!n)return;const c=n.dataset?n.dataset.groupId:"";if(!c||n.classList.contains("removed"))return;r.preventDefault();const x=c.replace(/^\d+-/,""),w=n.classList.contains("learning"),P=n.classList.contains("skipped");if(r.shiftKey){r.preventDefault(),M(x,w?"pending":"learning");return}if(r.altKey){r.preventDefault(),M(x,P?"pending":"skipped");return}}T(()=>{if(!(!a||!p.current))return p.current?.addEventListener("contextmenu",U),p.current?.addEventListener("click",A),()=>{p.current?.removeEventListener("contextmenu",U),p.current?.removeEventListener("click",A)}},[a]);const L=N?.removed||[],E=N?.done.filter(r=>!L.includes(r)).length||0,Q=N?.learning.filter(r=>!L.includes(r)).length||0,B=N?.skipped.filter(r=>!L.includes(r)).length||0,R=a.progress.find(r=>r.resourceId===s)?.total||0,F=Math.round(E/R*100);return e("div",{class:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{id:l?.type==="company"?"customized-roadmap":"original-roadmap",class:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e("div",{ref:b,class:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[d&&e("div",{className:"sticky top-1 mx-1 mb-0 mt-1 rounded-xl bg-gray-900 p-4 text-gray-300",children:[e("h2",{className:"mb-1.5 text-base",children:"Follow the Instructions below to update your progress"}),e("ul",{className:"flex flex-col gap-1",children:[e("li",{className:"leading-loose",children:[e("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Right Mouse Click"})," ","on a topic to mark as"," ",e("span",{className:"font-medium text-white",children:"Done"}),"."]}),e("li",{className:"leading-loose",children:[e("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Shift"})," ","+"," ",e("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Click"})," ","on a topic to mark as"," ",e("span",{className:"font-medium text-white",children:"In progress"}),"."]})]})]}),e("div",{className:"p-4",children:[!d&&e("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[a.name,"'s Progress"]}),e("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:["You are looking at ",a.name,"'s progress."," ",e("button",{className:"text-blue-600 underline",onClick:h,children:"View your progress"}),"."]}),e("p",{className:"block text-gray-500 md:hidden",children:e("button",{className:"text-blue-600 underline",onClick:h,children:"View your progress."})})]}),e("p",{class:`-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden ${i?"striped-loader":""}`,children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:F}),"% Done"]}),e("span",{children:[e("span",{children:E})," of ",e("span",{children:R})," done"]})]}),e("p",{class:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${i?"striped-loader":""}`,children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:F}),"% Done"]}),e("span",{children:[e("span",{children:E})," completed"]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-learning":"",children:Q})," in progress"]}),B>0&&e(D,{children:[e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-skipped":"",children:B})," ","skipped"]})]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-total":"",children:R})," Total"]})]})]}),e("div",{id:"resource-svg-wrap",ref:p,className:"px-4 pb-2"}),i&&e("div",{class:"flex w-full justify-center",children:e(re,{isDualRing:!1,className:"mb-4 mt-2 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e("button",{type:"button",className:`absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden ${d?"hover:bg-gray-800":"hover:bg-gray-100"}`,onClick:u,children:[e("img",{alt:"close",src:ae,className:"h-4 w-4"}),e("span",{class:"sr-only",children:"Close modal"})]})]})})})}const ce=[{label:"Members",value:"member"},{label:"Roadmaps",value:"roadmap"}];function Re(){const{teamId:g}=W(),{gb:s}=J(),[a,m]=v(!0),h=V(),f=Y(q),u=G(),[o,d]=v(),[l,p]=v([]),[b,$]=v(s||"member");async function _(){const{response:t,error:i}=await H(`https://api.roadmap.sh/v1-get-team-progress/${g}`);if(i||!t){h.error(i?.message||"Failed to get team progress");return}p(t.sort((y,k)=>y.email===u?.email?-1:k.email===u?.email?1:0))}if(T(()=>{g&&_().then(()=>{j.set(""),m(!1)})},[g]),a)return null;if(!g){window.location.href="/";return}T(()=>{b&&X({gb:b})},[b]);const N=[];for(const t of f?.roadmaps||[]){const i=[];for(const y of l){const k=y.progress.find(C=>C.resourceId===t);k&&i.push({member:y,progress:k})}i.length&&N.push({resourceId:t,resourceTitle:i?.[0].progress?.resourceTitle||"",resourceType:"roadmap",members:i})}return e("div",{children:[o&&e(ie,{member:o.member,teamId:g,resourceId:o.resourceId,resourceType:"roadmap",onClose:()=>{d(void 0)},onShowMyProgress:()=>{d({resourceId:o.resourceId,member:l.find(t=>t.email===u?.email)})}}),e("div",{className:"flex items-center gap-2",children:ce.map(t=>e("button",{className:`rounded-md border p-1 px-2 text-sm ${b===t.value?" border-gray-400 bg-gray-200 ":""}`,onClick:()=>$(t.value),children:t.label}))}),e("div",{className:"mt-6",children:[b==="roadmap"&&e("div",{className:"grid gap-4 sm:grid-cols-2",children:N.map(t=>e(le,{roadmap:t,onShowResourceProgress:(i,y)=>{d({resourceId:y,member:i})}},t.resourceId))}),b==="member"&&e("div",{className:"grid gap-4 sm:grid-cols-2",children:l.map(t=>e(oe,{member:t,isMyProgress:t?.email===u?.email,onShowResourceProgress:i=>{d({resourceId:i,member:t})}}))})]})]})}export{Re as TeamProgressPage};
