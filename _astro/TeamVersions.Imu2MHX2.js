import{j as e}from"./jsx-runtime.BPj4-Rfu.js";import{r}from"./index.SSXOyoI7.js";import{a as $}from"./http.B-35sOsF.js";import{c as C,r as g,a as k,b as E}from"./resource-progress.ClJBolsy.js";import{g as I,d as R,s as A}from"./browser.DS5mYzWA.js";import{u as D}from"./use-outside-click.BWzraQDw.js";import{u as O}from"./use-keydown.DCIacX8c.js";import{i as U}from"./jwt.M546E6_Y.js";import{u as _}from"./use-auth.BNYEoi-W.js";import{u as L}from"./use-toast.CK2mpur1.js";import{D as z}from"./DropdownIcon.D2SrBd8m.js";import"./roadmap.SDi3zlny.js";import"./index.Bhz7cRIx.js";import"./index.CEvxOxeV.js";import"./toast.BGQI3kl5.js";import"./classname.VuY_V_HN.js";import"./bundle-mjs.CZZD-8Ii.js";function ae(w){const{t:d}=I();if(!U())return;const{resourceId:o,resourceType:i}=w,m=_(),b=L(),u=r.useRef(null),[j,v]=r.useState(!0),[f,a]=r.useState(!1),[y,N]=r.useState(0),[p,T]=r.useState([]),[s,l]=r.useState(null);let c;const h=s?s.team.avatar:m?.avatar,x=s?s.team.name:m?.name;s?.team.avatar?c=!0:c=!!(!s&&m?.avatar),D(u,()=>{a(!1)}),O("Escape",()=>{a(!1)});async function P(){const{response:t,error:n}=await $(`https://api.roadmap.sh/v1-get-team-versions?${new URLSearchParams({resourceId:o,resourceType:i})}`);if(n||!t){b.error(n?.message||"Failed to load team versions.");return}if(T(t),d){const S=t.find(V=>V.team._id===d)||null;l(S)}setTimeout(()=>{v(!1),setTimeout(()=>{N(100)},50)},0)}return r.useEffect(()=>{P().finally(()=>{})},[]),r.useEffect(()=>{if(C(),!s){R("t"),g(i,o).then();return}A({t:s.team._id}),g(i,o).then(()=>{s.config?.removed?.forEach(t=>{k(t,"removed")}),E()})},[s]),j||!p.length?null:e.jsxs("div",{className:`relative h-7 transition-opacity duration-500 sm:h-auto opacity-${y}`,children:[e.jsxs("button",{className:"inline-flex h-7 items-center justify-between gap-1 rounded-md border px-1.5 py-1.5 text-xs font-medium hover:bg-gray-50 focus:outline-0 sm:h-8 sm:w-40 sm:px-3 sm:text-sm",onClick:()=>a(!f),children:[e.jsxs("div",{className:"hidden w-full items-center justify-between sm:flex",children:[e.jsx("span",{className:"truncate",children:s?.team.name||"Team Versions"}),e.jsx(z,{className:"h-3 w-3 sm:h-4 sm:w-4"})]}),e.jsx("div",{className:"sm:hidden",children:c?e.jsx("img",{src:h?`https://dodrc8eu8m09s.cloudfront.net/avatars/${h}`:"/images/default-avatar.png",alt:`${x} Avatar`,className:"h-5 w-5 rounded-full object-cover"}):e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-gray-200 text-xs",children:x?.charAt(0).toUpperCase()})})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 block bg-black/20 sm:hidden","aria-hidden":"true"}),e.jsxs("div",{ref:u,className:"fixed bottom-0 left-0 z-50 mt-1 h-fit w-full overflow-hidden rounded-md bg-white py-0.5 shadow-md sm:absolute sm:left-0 sm:right-0 sm:top-full sm:border",children:[e.jsx("button",{className:`flex h-8 w-full items-center justify-between px-3 py-1.5 text-xs font-medium hover:bg-gray-100 sm:text-sm ${s?"bg-white":"bg-gray-100"}`,onClick:()=>{l(null),a(!1)},children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("span",{className:"truncate",children:"Personal"})})}),p.map(t=>{const n=s?.team._id===t.team._id;return e.jsx("button",{className:`flex h-8 w-full items-center justify-between px-3 py-1.5 text-xs font-medium hover:bg-gray-100 sm:text-sm ${n?"bg-gray-100":"bg-white"}`,onClick:()=>{l(t),a(!1)},children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("span",{className:"truncate",children:t.team.name})})},t?.team?._id)})]})]})]})}export{ae as TeamVersions};
