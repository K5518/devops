<h1 id="using-pg_ctlcluster">Using pg_ctlcluster</h1>
<p><code>pg_ctlcluster</code> is a command-line utility provided by PostgreSQL to manage database clusters. It is especially helpful for users who have multiple PostgreSQL clusters running on the same system. In this section, we will explore the essential features of <code>pg_ctlcluster</code> for installing and setting up PostgreSQL database clusters.</p>
<h2 id="overview">Overview</h2>
<p><code>pg_ctlcluster</code> is a wrapper utility around the standard PostgreSQL <code>pg_ctl</code> utility to manage multiple instances of PostgreSQL clusters on your system. The key distinction between the two utilities is that <code>pg_ctlcluster</code> works at the cluster level, not at the instance level like <code>pg_ctl</code>.</p>
<p><code>pg_ctlcluster</code> is hardware-agnostic and can be used on various platforms, including Debian, Ubuntu, and other Linux distributions.</p>
<h2 id="syntax">Syntax</h2>
<p>The basic syntax for <code>pg_ctlcluster</code> is as follows:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" lang="plaintext"><code><span class="line"><span>pg_ctlcluster &#x3C;version> &#x3C;cluster name> &#x3C;action> [&#x3C;options>]</span></span></code></pre>
<p>Where:</p>
<ul>
<li><code>&#x3C;version></code>: The PostgreSQL version you want to operate on.</li>
<li><code>&#x3C;cluster name></code>: The name of the cluster you want to manage.</li>
<li><code>&#x3C;action></code>: The action to perform, such as <code>start</code>, <code>stop</code>, <code>restart</code>, <code>reload</code>, <code>status</code>, or <code>promote</code>.</li>
<li><code>[&#x3C;options>]</code>: Optional flags and arguments you want to give the command.</li>
</ul>
<h2 id="common-actions">Common Actions</h2>
<p>Here are some of the most common actions you can perform with <code>pg_ctlcluster</code>:</p>
<ul>
<li>
<p><strong>Start a cluster</strong>: To start a specific PostgreSQL cluster running at a particular version, you can use the following command:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" lang="bash"><code><span class="line"><span style="color:#50FA7B">pg_ctlcluster</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">versio</span><span style="color:#F8F8F2">n</span><span style="color:#FF79C6">></span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">cluster</span><span style="color:#F1FA8C"> nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> start</span></span></code></pre>
</li>
<li>
<p><strong>Stop a cluster</strong>: To stop a specific PostgreSQL cluster running at a particular version, use the following command:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" lang="bash"><code><span class="line"><span style="color:#50FA7B">pg_ctlcluster</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">versio</span><span style="color:#F8F8F2">n</span><span style="color:#FF79C6">></span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">cluster</span><span style="color:#F1FA8C"> nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> stop</span></span></code></pre>
</li>
<li>
<p><strong>Restart a cluster</strong>: To restart a specific PostgreSQL cluster running at a particular version, use the following command:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" lang="bash"><code><span class="line"><span style="color:#50FA7B">pg_ctlcluster</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">versio</span><span style="color:#F8F8F2">n</span><span style="color:#FF79C6">></span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">cluster</span><span style="color:#F1FA8C"> nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> restart</span></span></code></pre>
</li>
<li>
<p><strong>Reload a cluster</strong>: To reload the PostgreSQL cluster configuration without stopping and starting the server, use:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" lang="bash"><code><span class="line"><span style="color:#50FA7B">pg_ctlcluster</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">versio</span><span style="color:#F8F8F2">n</span><span style="color:#FF79C6">></span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">cluster</span><span style="color:#F1FA8C"> nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> reload</span></span></code></pre>
</li>
<li>
<p><strong>Get cluster status</strong>: To check the status of a specific PostgreSQL cluster running at a particular version, use:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" lang="bash"><code><span class="line"><span style="color:#50FA7B">pg_ctlcluster</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">versio</span><span style="color:#F8F8F2">n</span><span style="color:#FF79C6">></span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">cluster</span><span style="color:#F1FA8C"> nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> status</span></span></code></pre>
</li>
<li>
<p><strong>Promote a cluster</strong>: To promote a standby cluster to the primary cluster (useful in replication scenarios), you can use:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" lang="bash"><code><span class="line"><span style="color:#50FA7B">pg_ctlcluster</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">versio</span><span style="color:#F8F8F2">n</span><span style="color:#FF79C6">></span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">cluster</span><span style="color:#F1FA8C"> nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> promote</span></span></code></pre>
</li>
</ul>
<h2 id="additional-options">Additional Options</h2>
<p>You can also use additional command options with <code>pg_ctlcluster</code>, such as:</p>
<ul>
<li><code>--foreground</code>: Run the server in the foreground.</li>
<li><code>--fast</code>: Stop the database cluster abruptly.</li>
<li><code>--timeout</code>: Add a timeout duration for starting, stopping, or restarting a cluster.</li>
<li><code>--options</code>: Pass additional options to the main <code>postgresql</code> executable.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p><code>pg_ctlcluster</code> is a powerful tool to manage multiple PostgreSQL clusters running on the same machine. It makes it easy to start, stop, and monitor the status of your clusters, allowing you to efficiently manage your PostgreSQL installations.</p>
<p>For more detailed information, check the official <a href="https://www.postgresql.org/docs/current/pgctlcluster.html" rel="noopener noreferrer nofollow" target="_blank">PostgreSQL documentation</a>.</p>