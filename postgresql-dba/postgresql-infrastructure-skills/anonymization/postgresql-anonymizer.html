<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/postgresql-dba/content/107-postgresql-infrastructure-skills/108-anonymization/100-postgresql-anonymizer.md"></div> <h1 id="postgresql-anonymizer">PostgreSQL Anonymizer</h1>
<p>PostgreSQL Anonymizer is an extension that helps you protect sensitive data by anonymizing and obfuscating it. It is essential for meeting privacy regulations and ensuring the security of personal information contained in your databases.</p>
<h2 id="key-features">Key Features</h2>
<ul>
<li><strong>Dynamic Masking</strong>: With dynamic masking, you can create specific views that display anonymized data. Therefore, you can have the real data in the underlying tables but only reveal necessary masked data to users or applications.</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#FF79C6">CREATE</span><span style="color:#FF79C6"> MASKED</span><span style="color:#F8F8F2"> VIEW masked_clients </span><span style="color:#FF79C6">AS</span><span style="color:#FF79C6"> SELECT</span><span style="color:#FF79C6"> *</span><span style="color:#FF79C6"> FROM</span><span style="color:#F8F8F2"> clients;</span></span>
<span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#BD93F9"> anon</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">mask_data</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">clients</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">masked_clients</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span></code></pre>
<ul>
<li><strong>In-Place Anonymization</strong>: You can also anonymize data in place, making the change permanent. This method is useful when you need to share databases between environments, such as testing and development, but want to ensure privacy.</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#BD93F9"> anon</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">anonymize</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">clients</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span></code></pre>
<ul>
<li><strong>Extensible and Customizable Functions</strong>: You can define your own anonymization functions, providing great flexibility in how you anonymize data. These custom functions can then be applied to specific columns or tables.</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#FF79C6">CREATE</span><span style="color:#FF79C6"> FUNCTION</span><span style="color:#50FA7B"> anon_ssn</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">text</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">RETURNS</span><span style="color:#FF79C6"> text</span><span style="color:#FF79C6"> AS</span></span>
<span class="line"><span style="color:#F8F8F2">$$</span></span>
<span class="line"><span style="color:#FF79C6">  DECLARE</span></span>
<span class="line"><span style="color:#F8F8F2">    ssn </span><span style="color:#FF79C6">text</span><span style="color:#F8F8F2"> :</span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> anon</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">pseudonymize_DISTRIBUTED</span><span style="color:#F8F8F2">($</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">  BEGIN</span></span>
<span class="line"><span style="color:#FF79C6">    RETURN</span><span style="color:#8BE9FD"> substring</span><span style="color:#F8F8F2">(ssn </span><span style="color:#FF79C6">for</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">||</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">-</span><span style="color:#E9F284">'</span><span style="color:#FF79C6"> ||</span><span style="color:#8BE9FD"> substring</span><span style="color:#F8F8F2">(ssn </span><span style="color:#FF79C6">from</span><span style="color:#BD93F9"> 5</span><span style="color:#FF79C6"> for</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">||</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">-</span><span style="color:#E9F284">'</span><span style="color:#FF79C6"> ||</span><span style="color:#8BE9FD"> substring</span><span style="color:#F8F8F2">(ssn </span><span style="color:#FF79C6">from</span><span style="color:#BD93F9"> 8</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#FF79C6">  END</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">$$ </span><span style="color:#FF79C6">LANGUAGE</span><span style="color:#F8F8F2"> plpgsql;</span></span>
<span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#BD93F9"> anon</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">set_anonymous_function</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">clients</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">ssn</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">anon_ssn(text)</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span></code></pre>
<h2 id="getting-started">Getting Started</h2>
<ol>
<li>Install the PostgreSQL Anonymizer extension:</li>
</ol>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#FF79C6">CREATE</span><span style="color:#F8F8F2"> EXTENSION </span><span style="color:#FF79C6">IF</span><span style="color:#FF79C6"> NOT</span><span style="color:#FF79C6"> EXISTS</span><span style="color:#F8F8F2"> anon CASCADE;</span></span>
<span class="line"></span></code></pre>
<ol start="2">
<li>Define the anonymization methods for each sensitive field in your tables. You can use the built-in functions or create your own.</li>
</ol>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#BD93F9"> anon</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">set_anonymous_function</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">clients</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">email</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">anon.email(text)</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span></code></pre>
<ol start="3">
<li>Apply anonymization using either dynamic masking or in-place methods, depending on your requirements.</li>
</ol>
<h2 id="additional-resources">Additional Resources</h2>
<p>For further details on PostgreSQL Anonymizer, consult the following resources:</p>
<ul>
<li><a href="https://postgresql-anonymizer.readthedocs.io/" rel="noopener noreferrer nofollow" target="_blank">Official PostgreSQL Anonymizer Documentation</a></li>
<li><a href="https://gitlab.com/dalibo/postgresql_anonymizer" rel="noopener noreferrer nofollow" target="_blank">GitHub Repository</a></li>
</ul>