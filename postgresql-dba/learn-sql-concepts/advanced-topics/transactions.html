<h1 id="transactions">Transactions</h1>
<p>Transactions are a fundamental concept in database management systems, allowing multiple statements to be executed within a single transaction context. In PostgreSQL, transactions provide ACID (Atomicity, Consistency, Isolation, and Durability) properties, which ensure that your data remains in a consistent state even during concurrent access or system crashes.</p>
<p>In this section, we will discuss the following aspects of transactions in PostgreSQL:</p>
<ul>
<li><strong>Transaction Control</strong>: How to start, commit, and rollback a transaction.</li>
<li><strong>Savepoints</strong>: Creating and managing savepoints within a transaction.</li>
<li><strong>Concurrency Control</strong>: Understanding isolation levels and concurrency issues.</li>
<li><strong>Locking</strong>: How to acquire and release locks for concurrent access.</li>
</ul>
<h2 id="transaction-control">Transaction Control</h2>
<p>Transactions in PostgreSQL can be controlled using the following SQL commands:</p>
<ul>
<li><code>BEGIN</code>: Starts a new transaction.</li>
<li><code>COMMIT</code>: Ends the current transaction and makes all changes permanent.</li>
<li><code>ROLLBACK</code>: Ends the current transaction, discarding all changes made.</li>
</ul>
<p>Example:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#FF79C6">BEGIN</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#6272A4">-- Perform multiple SQL statements here</span></span>
<span class="line"><span style="color:#FF79C6">COMMIT</span><span style="color:#F8F8F2">;</span></span></code></pre>
<h2 id="savepoints">Savepoints</h2>
<p>Savepoints allow you to create intermediate points within a transaction, to which you can rollback without discarding the entire transaction. They are useful when you need to undo part of a transaction without affecting other parts of the transaction.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6272A4">-- Start a transaction</span></span>
<span class="line"><span style="color:#FF79C6">BEGIN</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">-- Perform some SQL statements</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">-- Create a savepoint</span></span>
<span class="line"><span style="color:#F8F8F2">SAVEPOINT my_savepoint;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">-- Perform more SQL statements</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">-- Rollback to the savepoint</span></span>
<span class="line"><span style="color:#FF79C6">ROLLBACK</span><span style="color:#FF79C6"> TO</span><span style="color:#F8F8F2"> my_savepoint;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">-- Continue working and commit the transaction</span></span>
<span class="line"><span style="color:#FF79C6">COMMIT</span><span style="color:#F8F8F2">;</span></span></code></pre>
<h2 id="concurrency-control">Concurrency Control</h2>
<p>Isolation levels are used to control the visibility of data in a transaction with respect to other concurrent transactions. PostgreSQL supports four isolation levels:</p>
<ul>
<li><code>READ UNCOMMITTED</code>: Allows transactions to see uncommitted changes made by other transactions.</li>
<li><code>READ COMMITTED</code>: Allows transactions to see changes made by other transactions only after they are committed.</li>
<li><code>REPEATABLE READ</code>: Guarantees that a transaction sees a consistent view of data for the entire length of the transaction.</li>
<li><code>SERIALIZABLE</code>: Enforces serial execution order of transactions, providing the highest level of isolation.</li>
</ul>
<p>You can set the transaction isolation level using the following command:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#FF79C6">SET</span><span style="color:#FF79C6"> TRANSACTION</span><span style="color:#FF79C6"> ISOLATION</span><span style="color:#FF79C6"> LEVEL</span><span style="color:#F8F8F2"> level_name;</span></span></code></pre>
<h2 id="locking">Locking</h2>
<p>Locks prevent multiple transactions from conflicting with each other when accessing shared resources. PostgreSQL provides various lock modes, such as <code>FOR UPDATE</code>, <code>FOR NO KEY UPDATE</code>, <code>FOR SHARE</code>, and <code>FOR KEY SHARE</code>.</p>
<p>Example:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#FF79C6">BEGIN</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#FF79C6"> *</span><span style="color:#FF79C6"> FROM</span><span style="color:#F8F8F2"> my_table </span><span style="color:#FF79C6">WHERE</span><span style="color:#F8F8F2"> id </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1</span><span style="color:#FF79C6"> FOR</span><span style="color:#FF79C6"> UPDATE</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#6272A4">-- Perform updates or deletions here</span></span>
<span class="line"><span style="color:#FF79C6">COMMIT</span><span style="color:#F8F8F2">;</span></span></code></pre>
<p>In summary, understanding and utilizing transactions in PostgreSQL is essential for ensuring data consistency and managing concurrent access to your data. By leveraging transaction control, savepoints, concurrency control, and locking, you can build robust and reliable applications that work seamlessly with PostgreSQL.</p>