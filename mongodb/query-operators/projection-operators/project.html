<h1 id="project">$project</h1>
<p>The <code>$project</code> is a projection operator in MongoDB, which is used during the aggregation process to reshape/output a document by specifying the fields to include or exclude. This is particularly helpful when you need to limit the amount of data retrieved from the database or modify the structure of the result.</p>
<h2 id="using-project">Using <code>$project</code></h2>
<p>The general syntax for the <code>$project</code> operator is:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">{ </span><span style="color:#FF5555;font-style:italic;text-decoration:underline">$project</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { </span><span style="color:#FF5555;font-style:italic;text-decoration:underline">field1</span><span style="color:#FF79C6">:</span><span style="color:#FF5555;font-style:italic;text-decoration:underline"> expression</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">, </span><span style="color:#FF5555;font-style:italic;text-decoration:underline">field2</span><span style="color:#FF79C6">:</span><span style="color:#FF5555;font-style:italic;text-decoration:underline"> expression</span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">, </span><span style="color:#FF5555;font-style:italic;text-decoration:underline">...</span><span style="color:#F8F8F2"> } }</span></span></code></pre>
<p>The key-value pairs within the <code>$project</code> operator specify the field names to be included in the final result, and their corresponding expressions help define how the output value would be computed.</p>
<h2 id="example">Example</h2>
<p>Let’s assume we have a “users” collection with documents that look like this:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#8BE9FE">  "</span><span style="color:#8BE9FD">_id</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FE">  "</span><span style="color:#8BE9FD">name</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">John Doe</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FE">  "</span><span style="color:#8BE9FD">posts</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> [</span></span>
<span class="line"><span style="color:#F8F8F2">    { </span><span style="color:#8BE9FE">"</span><span style="color:#8BE9FD">title</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">Sample Post 1</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FE">"</span><span style="color:#8BE9FD">views</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 43</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">    { </span><span style="color:#8BE9FE">"</span><span style="color:#8BE9FD">title</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">Sample Post 2</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FE">"</span><span style="color:#8BE9FD">views</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 89</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">  ]</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>If you want to retrieve only the name and the total number of posts for each user, you can execute the following aggregate query with a <code>$project</code> operator:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">db.users.</span><span style="color:#50FA7B">aggregate</span><span style="color:#F8F8F2">([</span></span>
<span class="line"><span style="color:#F8F8F2">  {</span></span>
<span class="line"><span style="color:#F8F8F2">    $project</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">      name</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">      totalPosts</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { $size</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">$posts</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">    },</span></span>
<span class="line"><span style="color:#F8F8F2">  },</span></span>
<span class="line"><span style="color:#F8F8F2">]);</span></span></code></pre>
<p>Here, we are including the <code>name</code> field and calculating the <code>totalPosts</code> value with the <code>$size</code> operator. The output will look like this:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#8BE9FE">  "</span><span style="color:#8BE9FD">_id</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FE">  "</span><span style="color:#8BE9FD">name</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">John Doe</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FE">  "</span><span style="color:#8BE9FD">totalPosts</span><span style="color:#8BE9FE">"</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 2</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h2 id="excluding-fields">Excluding Fields</h2>
<p>By default, using a field with a value of 0 (zero) within the <code>$project</code> operator will exclude all the other fields except for the specified ones. It’s important to note that the <code>_id</code> field is always included in the output unless explicitly excluded by specifying <code>_id: 0</code>.</p>
<p>For example, if you only want to exclude the “posts” field, you can do that as follows:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">db.users.</span><span style="color:#50FA7B">aggregate</span><span style="color:#F8F8F2">([</span></span>
<span class="line"><span style="color:#F8F8F2">  {</span></span>
<span class="line"><span style="color:#F8F8F2">    $project</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">      posts</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">    },</span></span>
<span class="line"><span style="color:#F8F8F2">  },</span></span>
<span class="line"><span style="color:#F8F8F2">]);</span></span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>The <code>$project</code> operator is a powerful tool in MongoDB’s aggregation framework that helps you manage the shape and size of the output documents. By understanding and leveraging its capabilities, you can effectively optimize your queries and reduce the amount of unnecessary data transfer in your application.</p>